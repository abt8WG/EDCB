dofile(mg.document_root..'\\string.lua')
ct=[=[
<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1.5">
<title>EpgTimer</title>
<link rel="shortcut icon" href="img/EpgTimer.ico">
<link href="css/default.css" rel="stylesheet" type="text/css">
<script src="js/jquery.min.js"></script>
<script src="js/common.js"></script>
</head>
<body>
<div id="wrap">
<div id="wrap2">
<div id="header" class="shadow">
<div id="menu">
<div id="menu_ico"><span></span></div>
<div class="menu">
<span>録画結果</span>
<div class="space"></div>
<nav>
<a href="epg.html">番組表</a>
<a href="reserve.html">予約一覧</a>
<a class="sp" href="autoaddepg.html">EPG予約</a>
<a class="sp" href="recinfo.html">録画結果</a>
<a href="search.html">検索</a>
</nav>
</div>
</div>
</div>
<div class="sidemenu">
<span class="title">EpgTimer</span>
<nav>
<a class="link" href="epg.html">番組表</a>
<a class="link" href="reserve.html">予約一覧</a>
<a class="link" href="tunerreserve.html">チューナー別</a>
<a class="link" href="autoaddepg.html">EPG予約</a>
<a class="link" href="recinfo.html">録画結果</a>
<a class="link" href="search.html">検索</a>
<a class="link" href="setting.html">設定</a>
</nav>
</div>
<div class="obfuscator"></div>
<div id="main">
<div class="center">
<h2>録画済み詳細</h2>
<div id="info">
<div id="base">
]=]
page=0+(mg.get_var(mg.request_info.query_string,'page') or 0)

edcb.htmlEscape=15
v=edcb.GetRecFileInfo(0+(mg.get_var(mg.request_info.query_string,'id') or 0))
if v then
  title=ConvertTitle(v.title)
  ti=string.gsub(v.title, '%[', '%%[')
  ti=string.gsub(ti, '%]', '%%]')
  info=string.gsub(v.programInfo, '(.-)'..ti..'\r?\n\r?\n', '')
  info=string.gsub(info, '\r?\n', '<br>\n')
  w=os.date('%w', os.time(v.startTime))
  ct=ct..'<h3>'..title..'</h3>\n'..(v.startTime and os.date('<p><span class="date">%Y/%m/%d('..({'日','月','火','水','木','金','土'})[w+1]..') %H:%M-', os.time(v.startTime))
     ..(v.durationSecond and os.date('%H:%M', os.time(v.startTime)+v.durationSecond) or '未定') or '未定')..'</span>\n'
     ..'<span class="service">'..v.serviceName..'</span></p>\n<div>\n'..info
  ct=string.gsub(ct, '<br>\n詳細情報<br>\n', '</div>\n</div>\n<div id="detail">\n<div>\n')
  ct=string.gsub(ct, '<br>\n<br>\n<br>', '')
  ct=string.gsub(ct, 'ジャンル : <br>\n', '</div>\n<ul class="square">\n<li>ドロップ － '..v.drops..'</li>\n<li>スクランブル － '..v.scrambles..'</li>\n<li>結果<p>'..v.comment..'</p></li>\n<li>ジャンル<p>')
  ct=string.gsub(ct, '<br>\n<br>\n映像 : ', '</p></li>\n<li>映像<p>')
  ct=string.gsub(ct, '<br>\n音声 : ', '</p></li>\n<li>音声<p>')
  ct=string.gsub(ct, 'kHz<br>\n<br>\n', 'kHz</p></li>\n<li>\nその他\n<p>')
  ct=string.gsub(ct, '放送<br>\n<br>\n', '放送<br>\n')
    ..'</p>\n</li>\n</ul></div>\n</div>\n<h2>エラーログ</h2>\n<div id="error">\n<div class="form">\n<pre>'..v.errInfo..'</pre>\n'
    ..'<form id="del" method="POST" action="recinfodel.html?id='..v.id..'&page='..page..'"></form>\n</div>\n<div id="button"><input class="button del" form="del" type="submit" value="削除"></div>\n'



end
ct=ct..[=[
</div>
</div>
</div>
</div>
</body>
</html>
]=]
mg.write('HTTP/1.1 200 OK\r\nContent-Type: text/html\r\nContent-Length: '..#ct..(mg.keep_alive(true) and '' or '\r\nConnection: close')..'\r\n\r\n', ct)
