path='Setting\\HttpPublic.ini'

ct=[=[
<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1.5">
<title>EpgTimer</title>
<link rel="shortcut icon" href="img/EpgTimer.ico">
<link href="css/default.css" rel="stylesheet" type="text/css">
<script src="js/jquery.min.js"></script>
<script src="js/common.js"></script>
</head>
<body>
<div id="wrap">
<div id="wrap2">
<div id="header" class="shadow">
<div id="menu">
<div id="menu_ico"><span></span></div>
<div class="menu">
<span></span>
<div class="space"></div>
<nav>
<a href="epg.html">番組表</a>
<a href="reserve.html">予約一覧</a>
<a href="autoaddepg.html">EPG予約</a>
<a class="sp" href="recinfo.html">録画結果</a>
<a href="search.html">検索</a>
</nav>
</div>
</div>
</div>
<div class="sidemenu">
<span class="title">EpgTimer</span>
<nav>
<a class="link" href="epg.html">番組表</a>
<a class="link" href="reserve.html">予約一覧</a>
<a class="link" href="tunerreserve.html">チューナー別</a>
<a class="link" href="autoaddepg.html">EPG予約</a>
<a class="link" href="recinfo.html">録画結果</a>
<a class="link" href="search.html">検索</a>
<a class="link" href="setting.html">設定</a>
</nav>
</div>
<div class="obfuscator"></div>
<div id="main">
<div id="dialog">
]=]
post=nil
if mg.request_info.request_method=='POST' then
  post=''
  repeat
    s=mg.read()
    post=post..(s or '')
  until not s
  if #post~=mg.request_info.content_length then
    post=nil
  end
end

if mg.get_var(mg.request_info.query_string,'reset') then

  edcb.WritePrivateProfile('GUIDE',nil,'',path)
  edcb.WritePrivateProfile('BACKGROUND',nil,'',path)
  edcb.WritePrivateProfile('SORT',nil,'',path)
  edcb.WritePrivateProfile('HIDE',nil,'',path)

  ct=ct..'初期化しました<script>function autoLink(){location.href="setting.html";}setTimeout("autoLink()",1000); </script>'

elseif post then
--  =(mg.get_var(post, '') or '')

  tkntrec=0+(mg.get_var(post, 'tkntrec') or 0)~=0
  option=0+(mg.get_var(post, 'option') or 0)~=0
  oneseg=0+(mg.get_var(post, 'oneseg') or 0)~=0

  hover=0+(mg.get_var(post, 'hover') or 0)~=0
  ONE_MIN_PX=(mg.get_var(post, 'ONE_MIN_PX') or '')
  MARGIN_HOUR=(mg.get_var(post, 'MARGIN_HOUR') or '')
  MARGIN_MIN=(mg.get_var(post, 'MARGIN_MIN') or '')

  background=(mg.get_var(post, 'background') or '')

  w_service=(mg.get_var(post, 'w_service') or '')
  w_service_sp=(mg.get_var(post, 'w_service_sp') or '')
  w_hour=(mg.get_var(post, 'w_hour') or '')
  w_hour_sp=(mg.get_var(post, 'w_hour_sp') or '')

  news=(mg.get_var(post, 'news') or '')
  sports=(mg.get_var(post, 'sports') or '')
  information=(mg.get_var(post, 'information') or '')
  drama=(mg.get_var(post, 'drama') or '')
  music=(mg.get_var(post, 'music') or '')
  variety=(mg.get_var(post, 'variety') or '')
  movie=(mg.get_var(post, 'movie') or '')
  anime=(mg.get_var(post, 'anime') or '')
  documentary=(mg.get_var(post, 'documentary') or '')
  theater=(mg.get_var(post, 'theater') or '')
  education=(mg.get_var(post, 'education') or '')
  welfare=(mg.get_var(post, 'welfare') or '')
  extension=(mg.get_var(post, 'extension') or '')
  other=(mg.get_var(post, 'other') or '')
  none=(mg.get_var(post, 'none') or '')
  nothing=(mg.get_var(post, 'nothing') or '')

  paint=0+(mg.get_var(post, 'paint') or 0)~=0
  reserved=(mg.get_var(post, 'reserved') or '')
  disable=(mg.get_var(post, 'disable') or '')
  partially=(mg.get_var(post, 'partially') or '')
  partially_border=(mg.get_var(post, 'partially_border') or '')
  shortage=(mg.get_var(post, 'shortage') or '')
  shortage_border=(mg.get_var(post, 'shortage_border') or '')

--  edcb.WritePrivateProfile('','',,path)

  edcb.WritePrivateProfile('SET','tkntrec',tkntrec,path)
  edcb.WritePrivateProfile('SET','option',option,path)

  edcb.WritePrivateProfile('GUIDE','oneseg',oneseg,path)
  edcb.WritePrivateProfile('GUIDE','hover',hover,path)
  edcb.WritePrivateProfile('GUIDE','ONE_MIN_PX',ONE_MIN_PX,path)
  edcb.WritePrivateProfile('GUIDE','MARGIN_HOUR',MARGIN_HOUR,path)
  edcb.WritePrivateProfile('GUIDE','MARGIN_MIN',MARGIN_MIN,path)
  edcb.WritePrivateProfile('GUIDE','service',w_service,path)
  edcb.WritePrivateProfile('GUIDE','service_sp',w_service_sp,path)
  edcb.WritePrivateProfile('GUIDE','hour',w_hour,path)
  edcb.WritePrivateProfile('GUIDE','hour_sp',w_hour_sp,path)

  edcb.WritePrivateProfile('BACKGROUND','background',background,path)

  edcb.WritePrivateProfile('BACKGROUND','news',news,path)
  edcb.WritePrivateProfile('BACKGROUND','sports',sports,path)
  edcb.WritePrivateProfile('BACKGROUND','information',information,path)
  edcb.WritePrivateProfile('BACKGROUND','drama',drama,path)
  edcb.WritePrivateProfile('BACKGROUND','music',music,path)
  edcb.WritePrivateProfile('BACKGROUND','variety',variety,path)
  edcb.WritePrivateProfile('BACKGROUND','movie',movie,path)
  edcb.WritePrivateProfile('BACKGROUND','anime',anime,path)
  edcb.WritePrivateProfile('BACKGROUND','documentary',documentary,path)
  edcb.WritePrivateProfile('BACKGROUND','theater',theater,path)
  edcb.WritePrivateProfile('BACKGROUND','education',education,path)
  edcb.WritePrivateProfile('BACKGROUND','welfare',welfare,path)
  edcb.WritePrivateProfile('BACKGROUND','extension',extension,path)
  edcb.WritePrivateProfile('BACKGROUND','other',other,path)
  edcb.WritePrivateProfile('BACKGROUND','none',none,path)
  edcb.WritePrivateProfile('BACKGROUND','nothing',nothing,path)

  edcb.WritePrivateProfile('BACKGROUND','paint',paint,path)
  edcb.WritePrivateProfile('BACKGROUND','reserved',reserved,path)
  edcb.WritePrivateProfile('BACKGROUND','disable',disable,path)
  edcb.WritePrivateProfile('BACKGROUND','partially',partially,path)
  edcb.WritePrivateProfile('BACKGROUND','partially_border',partially_border,path)
  edcb.WritePrivateProfile('BACKGROUND','shortage',shortage,path)
  edcb.WritePrivateProfile('BACKGROUND','shortage_border',shortage_border,path)

  for i=0,10000 do
    v=mg.get_var(post, 'sort', i)
    if not v then break end
    edcb.WritePrivateProfile('SORT','count',i,path)
    edcb.WritePrivateProfile('SORT','sort'..i,v,path)
  end

  if mg.get_var(post, 'hide') then
    for i=0,10000 do
      v=mg.get_var(post, 'hide', i)
      if not v then break end
      edcb.WritePrivateProfile('HIDE','count',i,path)
      edcb.WritePrivateProfile('HIDE','hide'..i,v,path)
    end
  else
    edcb.WritePrivateProfile('HIDE',nil,'',path)
  end

  ct=ct..'保存しました<script>function autoLink(){location.href="setting.html";}setTimeout("autoLink()",1000); </script>'

end
ct=ct..[=[
</div>
</div>
</div>
</body>
</html>
]=]
mg.write('HTTP/1.1 200 OK\r\nContent-Type: text/html\r\nContent-Length: '..#ct..(mg.keep_alive(true) and '' or '\r\nConnection: close')..'\r\n\r\n', ct)
